<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>historia do site</h1>
    <div class="campos">
        <p> Nome do pet:</p>
        <input type="text" placeholder="Informe o nome do PET" name="nome" id="nome">
    </div>
    <div class="campos">
        <p>Conte uma história:</p>
        <input class="input-historia" type="text" name="descricao" id="descricao">
        <input type="text" name="nomeAutor" id="nomeAutor" placeholder="nomeAutor">
        <input type="text" name="fkUsuario" id="fkUsuario" placeholder="fkUsuario">
    </div>
    <input type="file" name="foto" id="foto">
    <button class="botao" onclick="enviandoHistoria()">Enviar</button>

    <input type="number" id="buscaInput">
    <button onclick="buscarPeloId()">Buscar</button>
    <div id="resulimg"></div>
</div>
</body>
</html>
<script>
    function enviandoHistoria() {
    const formData = new FormData();
    formData.append('foto', foto.files[0])
    formData.append('nome', nome.value)
    formData.append('descricao', descricao.value)
    formData.append('nomeAutor', nomeAutor.value)
    formData.append('fkUsuario', fkUsuario.value)
    

    fetch("/historias/enviarhistoria", {
      method: "POST",
      body: formData
    })
      .then(res => {
        alert(`História do site enviada com sucesso`)
        // window.location = "./perfil.html"
      })
      .catch(err => {
        console.log(err);
      })
  }

  function buscarPeloId() {
    fetch(`/historias/${buscaInput.value}`, {
      method: "GET"
    })
      .then(res => {
        res.json().then(json => {
          const historia = json[0];
          resulimg.innerHTML = `
    <div>
    <h1>${historia.nome}</h1>
    <p>${historia.descricao}</p>
    <img src="../assets/${historia.imagem}" width="400px" alt="">
    </div>`

        })
      })
      .catch(err => {
        console.log(err);
      })
  }
</script>